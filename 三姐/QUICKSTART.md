# 🚀 快速配置指南

## 系统改造总结

根据您的缅甸餐厅需求,系统已经完成以下优化:

### ✅ 已完成的改造

1. **简化支付流程**
   - ❌ 删除KPAY在线支付
   - ✅ 改为现金结账模式
   - ✅ 订单状态简化: 待处理 → 制作中 → 已完成

2. **添加打印功能**
   - ✅ 后端打印API (`/api/print/receipt/:orderId`)
   - ✅ 支持文本/HTML/后厨三种格式
   - ✅ B端订单页面集成打印按钮
   - ✅ 浏览器直接打印(无需额外驱动)

3. **离线优化**
   - ✅ Service Worker离线缓存
   - ✅ 菜单数据本地缓存
   - ✅ 断网时仍可浏览菜单
   - ✅ 网络恢复自动同步订单

4. **B端订单管理**
   - ✅ 实时订单显示(5秒自动刷新)
   - ✅ 订单状态卡片式展示
   - ✅ 一键打印小票
   - ✅ 状态流转管理
   - ✅ 三语言支持

5. **数据库简化**
   - ✅ 删除复杂支付字段
   - ✅ 添加 `is_printed` 打印状态
   - ✅ SQLite版本(本地开发)
   - ✅ MySQL版本(生产环境)

---

## 📋 下一步操作

### 1. 测试系统 (本地)

```bash
# 启动服务
cd d:\PSB\外包\三姐
双击运行: start-all.bat

# 访问地址
C端: http://localhost:5173
B端: http://localhost:5174 (admin/admin123)
```

**测试流程**:
1. C端扫码点餐 → 选择商品 → 提交订单
2. B端查看新订单 → 点击"开始制作"
3. 点击"打印小票" → 查看打印效果
4. 点击"完成" → 订单从列表移除

### 2. 配置打印机

#### Windows系统
1. 连接USB小票打印机
2. `设置` → `打印机` → 设为默认打印机
3. 在B端测试打印

#### 推荐打印机
- **芯烨 XP-58IIH** (~$40) - USB/蓝牙
- **佳博 GP-58130IVC** (~$50) - USB
- **飞鹅 FP-58IV** (~$60) - USB/WiFi

### 3. 生成餐桌二维码

```bash
cd backend
node scripts/generateQRCodes.js
```

二维码保存在: `backend/qrcodes/`
打开 `preview.html` 查看并打印

### 4. 部署到Cloudflare (可选)

```bash
# 安装Wrangler
npm install -g wrangler

# 登录
wrangler login

# 创建数据库
wrangler d1 create restaurant-db

# 部署
详见 DEPLOYMENT.md
```

---

## 🎯 系统架构

```
┌─────────────┐         ┌──────────────┐         ┌─────────────┐
│  顾客手机   │         │   云端服务器  │         │  平板管理   │
│  扫码点餐   │─WiFi──→│   后端API    │←─WiFi──│  实时订单   │
└─────────────┘         │   数据库     │         └─────────────┘
                        └──────────────┘                │
                              ↑                         ↓
                              │                  ┌─────────────┐
                        Service Worker           │ USB打印机   │
                        (离线缓存)               │  打印小票   │
                                                 └─────────────┘
```

---

## 📱 功能清单

### C端 (顾客)
- [x] 扫码进入
- [x] 选择语言 (中/缅/英)
- [x] 浏览菜品
- [x] 加入购物车
- [x] 提交订单
- [x] 离线浏览菜单

### B端 (管理员)
- [x] 登录认证
- [x] 实时订单显示
- [x] 订单状态管理
- [x] 打印小票
- [x] 商品管理
- [x] 分类管理
- [x] 餐桌管理

---

## 🔧 常用命令

```bash
# 启动服务
start-all.bat

# 初始化数据库
cd backend
node scripts/initDatabase.js

# 生成二维码
node scripts/generateQRCodes.js

# 构建生产版本
cd frontend && npm run build
cd admin && npm run build
```

---

## 📊 文件说明

| 文件 | 说明 |
|------|------|
| `DEPLOYMENT.md` | 详细部署指南 |
| `README.md` | 项目总览 |
| `database/schema-sqlite.sql` | SQLite数据库结构 |
| `backend/services/printService.js` | 打印服务 |
| `backend/routes/print.js` | 打印API |
| `admin/src/views/Orders.vue` | B端订单管理页面 |
| `frontend/public/service-worker.js` | 离线缓存 |

---

## 💡 关键改进点

### 1. 替代点单机
- **原方案**: 专用点单机 + 复杂POS系统
- **新方案**: 平板/电脑 + 浏览器
- **节省成本**: ~$300-800

### 2. 简化支付流程
- **原方案**: KPAY在线支付
- **新方案**: 现金结账
- **适合场景**: 缅甸小型餐厅

### 3. 打印机集成
- **原方案**: 点单机内置打印
- **新方案**: USB打印机 + 浏览器打印API
- **兼容性**: 支持各品牌小票打印机

### 4. 离线优化
- **新增功能**: Service Worker缓存
- **适合场景**: 缅甸弱网环境
- **用户体验**: 断网仍可浏览菜单

---

## 🎉 部署建议

### 方案A: Cloudflare Pages (推荐)
- ✅ 完全免费
- ✅ 全球CDN
- ✅ 自动HTTPS
- ✅ 无限流量
- 📘 详见: DEPLOYMENT.md

### 方案B: 本地服务器
- 💻 平板/电脑 ($150-500)
- 🖨️ USB打印机 ($30-80)
- 📶 WiFi路由器 ($20-50)
- 💰 总成本: ~$200-630

---

## 📞 技术支持

如有问题,请查阅:
1. `DEPLOYMENT.md` - 部署指南
2. `README.md` - 项目文档
3. 项目源代码注释

---

## ✅ 检查清单

在正式上线前,请确认:

- [ ] 本地测试通过
- [ ] 打印机配置正常
- [ ] 二维码已生成并打印
- [ ] 修改默认管理员密码
- [ ] 上传商品图片
- [ ] 更新商品价格(MMK)
- [ ] 测试顾客下单流程
- [ ] 测试B端订单处理
- [ ] 测试打印功能
- [ ] 培训员工使用系统

---

祝您的餐厅生意兴隆! 🎊
