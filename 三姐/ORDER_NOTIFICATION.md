# 订单提醒功能说明

## 功能概述
B端管理后台已添加实时订单提醒功能，当C端有新订单时，B端会自动显示通知提醒。

## 主要功能

### 1. 实时订单检测
- **轮询机制**: 每10秒自动检查一次新订单
- **多服务支持**: 同时监控餐桌订单、外卖配送和来店自取三种服务类型
- **智能去重**: 已通知过的订单不会重复提醒

### 2. 桌面通知
当有新订单时，会在页面右上角弹出通知：
- **通知内容**:
  - 订单类型（餐桌订单/外卖配送/来店自取）
  - 订单号
  - 订单金额
  - 桌号（如果是餐桌订单）
  - 备注信息
- **通知特性**:
  - 不会自动关闭，需手动关闭
  - 点击通知可直接跳转到对应管理页面
  - 同时播放提示音

### 3. 提示音
- 使用Web Audio API生成双音提示音
- 第一声：800Hz，持续200ms
- 第二声：1000Hz，持续200ms（延迟250ms）
- 音量：30%

### 4. 菜单徽章
在侧边栏菜单项上显示待处理订单数量：
- **餐桌订单管理**: 显示待处理的餐桌订单数
- **外卖配送**: 显示待处理的外卖订单数
- **来店自取**: 显示待处理的自取订单数
- 徽章带有脉冲动画效果，更加醒目

## 技术实现

### 1. 轮询机制
```javascript
// 组件挂载时开始轮询
onMounted(async () => {
  await authStore.getProfile()
  startPolling() // 开始每10秒检查一次
})

// 组件卸载时停止轮询
onUnmounted(() => {
  stopPolling()
})
```

### 2. 订单检查逻辑
- 并发请求三个API获取所有类型订单
- 筛选出 `status === 'pending'` 的订单
- 检查订单ID是否在已通知集合中
- 新订单则显示通知并播放提示音

### 3. 状态管理
```javascript
// 订单数量统计
const pendingTableOrders = ref(0)
const pendingDeliveryOrders = ref(0)
const pendingTakeawayOrders = ref(0)

// 已通知的订单ID集合（防止重复通知）
const notifiedOrders = new Set()
```

## 使用说明

### 管理员操作
1. **登录B端**: 访问 http://localhost:5174
2. **自动监控**: 登录后自动开始监控新订单
3. **查看通知**: 有新订单时右上角会弹出通知
4. **处理订单**: 点击通知或菜单项进入对应管理页面

### 订单状态说明
- **pending**: 待处理（会触发通知）
- **preparing**: 准备中（不触发通知）
- **completed**: 已完成（不触发通知）

### 菜单徽章
- 徽章显示该类型的 **待处理订单总数**
- 红色渐变背景，带白色边框
- 2秒脉冲动画循环

## 注意事项

1. **浏览器要求**: 
   - 需要支持Web Audio API
   - 建议使用Chrome、Edge、Firefox等现代浏览器

2. **权限要求**:
   - 需要登录B端管理后台
   - 具有订单查询权限

3. **性能考虑**:
   - 每10秒轮询一次，不会对服务器造成过大压力
   - 使用Promise.all并发请求，提高响应速度
   - 已通知订单ID存储在内存中，避免重复通知

4. **提示音说明**:
   - 使用纯代码生成提示音，无需外部音频文件
   - 如需更换为自定义音频，可以替换 `playNotificationSound` 函数

## 仪表盘链接

### 功能说明
- 侧边栏第一个菜单项是 **仪表盘**（DataLine图标）
- 点击即可进入仪表盘页面，查看：
  - 今日订单数
  - 今日营收
  - 商品数量
  - 餐桌数量

### 路由配置
```javascript
{
  path: '/dashboard',
  name: 'Dashboard',
  component: () => import('@/views/Dashboard.vue'),
  meta: { title: '仪表盘', icon: 'DataLine' }
}
```

## 未来优化建议

1. **WebSocket实时推送**: 替换轮询机制，实现真正的实时推送
2. **自定义提示音**: 允许管理员上传自定义提示音
3. **通知设置**: 添加静音、通知频率等个性化设置
4. **订单优先级**: 根据订单金额或等待时间设置不同提醒优先级
5. **声音提醒开关**: 允许管理员控制是否播放提示音

## 测试流程

1. **启动服务**:
   ```bash
   # 后端
   cd backend
   npm start

   # C端
   cd frontend
   npm run dev

   # B端
   cd admin
   npm run dev
   ```

2. **创建测试订单**:
   - 打开C端 http://localhost:5173
   - 选择任意服务类型（堂食/外卖/自取）
   - 添加商品并确认订单

3. **验证通知**:
   - 打开B端 http://localhost:5174
   - 等待最多10秒
   - 应该看到右上角弹出通知
   - 应该听到双音提示音
   - 菜单项上应显示徽章数字

4. **点击通知**:
   - 点击通知应跳转到对应管理页面
   - 订单应显示在列表中

## 版本记录

- **v1.0.0** (2025-11-11):
  - 实现基础订单提醒功能
  - 添加菜单徽章显示
  - 实现Web Audio API提示音
  - 10秒轮询机制
