# ä»£ç æ¸…ç†æ€»ç»“ä¸Bç«¯å¼€å‘æŒ‡å—

## âœ… å·²å®Œæˆçš„æ¸…ç†å·¥ä½œ

### 1. åˆ é™¤çš„æ–‡ä»¶
- âŒ `æœ¬åœ°æµ‹è¯•æŒ‡å—.md` - å·²è¿‡æ—¶çš„æµ‹è¯•æ–‡æ¡£
- âŒ `è´­ç‰©è½¦åŠŸèƒ½è¯´æ˜.md` - ä¸´æ—¶åŠŸèƒ½è¯´æ˜æ–‡æ¡£
- âŒ æ—§ç‰ˆ `README.md` - å·²è¢«æ–°ç‰ˆæ›¿æ¢

### 2. ä¿ç•™çš„æ ¸å¿ƒæ–‡ä»¶
- âœ… `README.md` - æ›´æ–°åçš„é¡¹ç›®æ€»è§ˆ
- âœ… `ADMIN_PLAN.md` - Bç«¯ç®¡ç†åå°å®Œæ•´è§„åˆ’
- âœ… `setup.ps1` - é¡¹ç›®åˆå§‹åŒ–è„šæœ¬
- âœ… `start-all.bat` - ä¸€é”®å¯åŠ¨è„šæœ¬
- âœ… `start-backend.bat` - åç«¯å¯åŠ¨è„šæœ¬
- âœ… `start-frontend.bat` - å‰ç«¯å¯åŠ¨è„šæœ¬

### 3. ä»£ç ç»“æ„éªŒè¯
- âœ… åç«¯ä»£ç : æ— å†—ä½™ä»£ç ,ç»“æ„æ¸…æ™°
- âœ… å‰ç«¯ä»£ç : å·²ä¼˜åŒ–,ç§»åŠ¨ç«¯é€‚é…å®Œæˆ
- âœ… æ•°æ®åº“: SQLiteé€‚é…å®Œæˆ,ç»“æ„åˆç†
- âœ… APIè·¯ç”±: è§„èŒƒå®Œæ•´

---

## ğŸ“‹ Bç«¯ç®¡ç†åå° - å¼€å‘è®¡åˆ’

### Phase 1: é¡¹ç›®æ­å»º (ç¬¬1å¤©)

#### 1.1 åˆ›å»ºAdminé¡¹ç›®
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºadminç›®å½•
cd d:\PSB\å¤–åŒ…\ç‚¹é¤ç³»ç»Ÿ
npm create vite@latest admin -- --template vue

cd admin
npm install

# å®‰è£…æ ¸å¿ƒä¾èµ–
npm install element-plus @element-plus/icons-vue
npm install vue-router pinia
npm install axios
npm install jwt-decode
npm install qrcode
npm install file-saver
npm install jszip

# å®‰è£…å¼€å‘ä¾èµ–
npm install -D sass
```

#### 1.2 é…ç½®Vite
```javascript
// vite.config.js
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import { resolve } from 'path'

export default defineConfig({
  plugins: [vue()],
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src')
    }
  },
  server: {
    port: 5174,
    proxy: {
      '/api': {
        target: 'http://localhost:3000',
        changeOrigin: true
      }
    }
  }
})
```

#### 1.3 ç›®å½•ç»“æ„
```
admin/
â”œâ”€â”€ public/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ auth.js
â”‚   â”‚   â”œâ”€â”€ store.js
â”‚   â”‚   â”œâ”€â”€ table.js
â”‚   â”‚   â”œâ”€â”€ category.js
â”‚   â”‚   â”œâ”€â”€ product.js
â”‚   â”‚   â”œâ”€â”€ order.js
â”‚   â”‚   â””â”€â”€ payment.js
â”‚   â”œâ”€â”€ assets/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ UploadImage.vue
â”‚   â”‚   â”œâ”€â”€ QRCodeGenerator.vue
â”‚   â”‚   â””â”€â”€ RichEditor.vue
â”‚   â”œâ”€â”€ layouts/
â”‚   â”‚   â”œâ”€â”€ AdminLayout.vue
â”‚   â”‚   â””â”€â”€ AuthLayout.vue
â”‚   â”œâ”€â”€ router/
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â”œâ”€â”€ auth.js
â”‚   â”‚   â””â”€â”€ app.js
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ request.js
â”‚   â”‚   â”œâ”€â”€ auth.js
â”‚   â”‚   â””â”€â”€ download.js
â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â””â”€â”€ Login.vue
â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚   â””â”€â”€ Index.vue
â”‚   â”‚   â”œâ”€â”€ store/
â”‚   â”‚   â”‚   â””â”€â”€ Settings.vue
â”‚   â”‚   â”œâ”€â”€ table/
â”‚   â”‚   â”‚   â”œâ”€â”€ List.vue
â”‚   â”‚   â”‚   â””â”€â”€ QRCode.vue
â”‚   â”‚   â”œâ”€â”€ menu/
â”‚   â”‚   â”‚   â”œâ”€â”€ CategoryList.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ ProductList.vue
â”‚   â”‚   â”‚   â””â”€â”€ ProductForm.vue
â”‚   â”‚   â”œâ”€â”€ order/
â”‚   â”‚   â”‚   â”œâ”€â”€ List.vue
â”‚   â”‚   â”‚   â””â”€â”€ Detail.vue
â”‚   â”‚   â””â”€â”€ payment/
â”‚   â”‚       â””â”€â”€ Settings.vue
â”‚   â”œâ”€â”€ App.vue
â”‚   â””â”€â”€ main.js
â””â”€â”€ package.json
```

---

### Phase 2: åç«¯APIå¼€å‘ (ç¬¬2-3å¤©)

#### 2.1 åˆ›å»ºç®¡ç†å‘˜æ•°æ®è¡¨
```sql
-- backend/scripts/createAdminTables.sql

-- ç®¡ç†å‘˜è¡¨
CREATE TABLE IF NOT EXISTS admins (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  username VARCHAR(50) UNIQUE NOT NULL,
  password VARCHAR(255) NOT NULL,
  name VARCHAR(100),
  role VARCHAR(20) DEFAULT 'admin',
  status TINYINT DEFAULT 1,
  last_login_at DATETIME,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- é—¨åº—è®¾ç½®è¡¨
CREATE TABLE IF NOT EXISTS store_settings (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  store_name VARCHAR(100),
  store_name_my VARCHAR(100),
  store_name_en VARCHAR(100),
  logo VARCHAR(255),
  address VARCHAR(255),
  phone VARCHAR(50),
  business_hours TEXT,
  description TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- æ”¯ä»˜è®¾ç½®è¡¨
CREATE TABLE IF NOT EXISTS payment_settings (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  payment_method VARCHAR(50) NOT NULL,
  merchant_id VARCHAR(100),
  api_key VARCHAR(255),
  api_secret VARCHAR(255),
  callback_url VARCHAR(255),
  is_enabled TINYINT DEFAULT 1,
  is_test_mode TINYINT DEFAULT 1,
  config TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- æ’å…¥é»˜è®¤ç®¡ç†å‘˜ (å¯†ç : admin123)
INSERT INTO admins (username, password, name, role) 
VALUES ('admin', '$2b$10$YourHashedPasswordHere', 'ç³»ç»Ÿç®¡ç†å‘˜', 'admin');
```

#### 2.2 åˆ›å»ºè®¤è¯ä¸­é—´ä»¶
```javascript
// backend/middleware/auth.js
const jwt = require('jsonwebtoken');

const JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key';

function authMiddleware(req, res, next) {
  const token = req.headers.authorization?.replace('Bearer ', '');
  
  if (!token) {
    return res.status(401).json({
      success: false,
      message: 'æœªæä¾›è®¤è¯ä»¤ç‰Œ'
    });
  }

  try {
    const decoded = jwt.verify(token, JWT_SECRET);
    req.admin = decoded;
    next();
  } catch (error) {
    return res.status(401).json({
      success: false,
      message: 'æ— æ•ˆçš„è®¤è¯ä»¤ç‰Œ'
    });
  }
}

module.exports = authMiddleware;
```

#### 2.3 åˆ›å»ºç®¡ç†å‘˜è·¯ç”±
```javascript
// backend/routes/admin.js
const express = require('express');
const bcrypt = require('bcryptjs');
const jwt = require('jsonwebtoken');
const router = express.Router();
const db = require('../config/database');
const authMiddleware = require('../middleware/auth');

const JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key';

// ç™»å½•
router.post('/login', async (req, res) => {
  try {
    const { username, password } = req.body;
    
    const admin = await db.query(
      'SELECT * FROM admins WHERE username = ? AND status = 1',
      [username]
    );

    if (admin.length === 0) {
      return res.json({
        success: false,
        message: 'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯'
      });
    }

    const isValid = await bcrypt.compare(password, admin[0].password);
    
    if (!isValid) {
      return res.json({
        success: false,
        message: 'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯'
      });
    }

    // æ›´æ–°æœ€åç™»å½•æ—¶é—´
    await db.query(
      'UPDATE admins SET last_login_at = CURRENT_TIMESTAMP WHERE id = ?',
      [admin[0].id]
    );

    // ç”ŸæˆToken
    const token = jwt.sign(
      { 
        id: admin[0].id,
        username: admin[0].username,
        role: admin[0].role
      },
      JWT_SECRET,
      { expiresIn: '7d' }
    );

    res.json({
      success: true,
      data: {
        token,
        admin: {
          id: admin[0].id,
          username: admin[0].username,
          name: admin[0].name,
          role: admin[0].role
        }
      },
      message: 'ç™»å½•æˆåŠŸ'
    });
  } catch (error) {
    res.status(500).json({
      success: false,
      message: error.message
    });
  }
});

// è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
router.get('/profile', authMiddleware, async (req, res) => {
  try {
    const admin = await db.query(
      'SELECT id, username, name, role, created_at FROM admins WHERE id = ?',
      [req.admin.id]
    );

    res.json({
      success: true,
      data: admin[0]
    });
  } catch (error) {
    res.status(500).json({
      success: false,
      message: error.message
    });
  }
});

module.exports = router;
```

#### 2.4 æ›´æ–°server.js
```javascript
// backend/server.js - æ·»åŠ ä»¥ä¸‹ä»£ç 

const adminRouter = require('./routes/admin');
const authMiddleware = require('./middleware/auth');

// ç®¡ç†å‘˜è·¯ç”± (æ— éœ€è®¤è¯)
app.use('/api/admin', adminRouter);

// ç®¡ç†å‘˜è·¯ç”± (éœ€è¦è®¤è¯)
app.use('/api/admin/store', authMiddleware, require('./routes/admin/store'));
app.use('/api/admin/tables', authMiddleware, require('./routes/admin/tables'));
app.use('/api/admin/categories', authMiddleware, require('./routes/admin/categories'));
app.use('/api/admin/products', authMiddleware, require('./routes/admin/products'));
app.use('/api/admin/orders', authMiddleware, require('./routes/admin/orders'));
app.use('/api/admin/payment', authMiddleware, require('./routes/admin/payment'));
```

---

### Phase 3: å‰ç«¯æ ¸å¿ƒåŠŸèƒ½å¼€å‘ (ç¬¬4-7å¤©)

#### ç¬¬4å¤©: è®¤è¯ç³»ç»Ÿ
- [ ] ç™»å½•é¡µé¢UI
- [ ] Tokenç®¡ç†
- [ ] è·¯ç”±å®ˆå«
- [ ] ç™»å‡ºåŠŸèƒ½

#### ç¬¬5å¤©: é¤æ¡Œç®¡ç†
- [ ] é¤æ¡Œåˆ—è¡¨é¡µé¢
- [ ] æ–°å¢/ç¼–è¾‘é¤æ¡Œ
- [ ] äºŒç»´ç ç”Ÿæˆ
- [ ] æ‰¹é‡ç”ŸæˆäºŒç»´ç 
- [ ] ä¸‹è½½åŠŸèƒ½

#### ç¬¬6å¤©: èœå•ç®¡ç† (ä¸Š)
- [ ] åˆ†ç±»ç®¡ç†é¡µé¢
- [ ] å•†å“åˆ—è¡¨é¡µé¢
- [ ] å•†å“è¡¨å•é¡µé¢
- [ ] å›¾ç‰‡ä¸Šä¼ ç»„ä»¶

#### ç¬¬7å¤©: èœå•ç®¡ç† (ä¸‹)
- [ ] è§„æ ¼ç®¡ç†
- [ ] ä¸Šæ¶/ä¸‹æ¶
- [ ] æœç´¢ç­›é€‰
- [ ] æ’åºåŠŸèƒ½

---

### Phase 4: è®¢å•ä¸é…ç½® (ç¬¬8-10å¤©)

#### ç¬¬8å¤©: è®¢å•ç®¡ç†
- [ ] è®¢å•åˆ—è¡¨
- [ ] è®¢å•è¯¦æƒ…
- [ ] çŠ¶æ€æ›´æ–°
- [ ] æœç´¢ç­›é€‰

#### ç¬¬9å¤©: é—¨åº—ä¸æ”¯ä»˜
- [ ] é—¨åº—ä¿¡æ¯è®¾ç½®
- [ ] Logoä¸Šä¼ 
- [ ] æ”¯ä»˜é…ç½®
- [ ] æµ‹è¯•åŠŸèƒ½

#### ç¬¬10å¤©: æµ‹è¯•ä¸ä¼˜åŒ–
- [ ] åŠŸèƒ½æµ‹è¯•
- [ ] Bugä¿®å¤
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] æ–‡æ¡£å®Œå–„

---

## ğŸ¯ MVPå…³é”®é‡Œç¨‹ç¢‘

### Milestone 1: å¯ç™»å½• (ç¬¬1-3å¤©å®Œæˆ)
- âœ… Adminé¡¹ç›®æ­å»º
- âœ… ç™»å½•é¡µé¢
- âœ… åç«¯è®¤è¯API
- âœ… Tokenç®¡ç†

### Milestone 2: æ ¸å¿ƒç®¡ç† (ç¬¬4-7å¤©å®Œæˆ)
- âœ… é¤æ¡Œç®¡ç†ä¸äºŒç»´ç 
- âœ… åˆ†ç±»ç®¡ç†
- âœ… å•†å“åŸºç¡€ç®¡ç†
- âœ… è§„æ ¼ç®¡ç†

### Milestone 3: ä¸šåŠ¡é—­ç¯ (ç¬¬8-10å¤©å®Œæˆ)
- âœ… è®¢å•ç®¡ç†
- âœ… é—¨åº—é…ç½®
- âœ… æ”¯ä»˜é…ç½®
- âœ… æµ‹è¯•ä¸Šçº¿

---

## ğŸ“š æŠ€æœ¯æ–‡æ¡£å‚è€ƒ

### Element Plus
- å®˜ç½‘: https://element-plus.org/zh-CN/
- ç»„ä»¶: Table, Form, Dialog, Upload, Button, Input, Select

### QRCodeç”Ÿæˆ
```bash
npm install qrcode
```

```javascript
import QRCode from 'qrcode';

async function generateQR(text) {
  try {
    const url = await QRCode.toDataURL(text);
    return url;
  } catch (err) {
    console.error(err);
  }
}
```

### æ–‡ä»¶ä¸‹è½½
```bash
npm install file-saver jszip
```

```javascript
import { saveAs } from 'file-saver';
import JSZip from 'jszip';

// å•ä¸ªæ–‡ä»¶ä¸‹è½½
saveAs(blob, 'filename.png');

// æ‰¹é‡æ‰“åŒ…ä¸‹è½½
const zip = new JSZip();
zip.file('qrcode1.png', blob1);
zip.file('qrcode2.png', blob2);
const content = await zip.generateAsync({type: 'blob'});
saveAs(content, 'qrcodes.zip');
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å®‰å…¨æ€§**
   - æ‰€æœ‰ç®¡ç†APIå¿…é¡»ç»è¿‡è®¤è¯
   - å¯†ç ä½¿ç”¨bcryptåŠ å¯†
   - Tokenè®¾ç½®åˆç†è¿‡æœŸæ—¶é—´

2. **ç”¨æˆ·ä½“éªŒ**
   - æ“ä½œè¦æœ‰loadingçŠ¶æ€
   - æˆåŠŸ/å¤±è´¥è¦æœ‰æç¤º
   - åˆ é™¤æ“ä½œè¦æœ‰ç¡®è®¤

3. **æ•°æ®æ ¡éªŒ**
   - å‰ç«¯è¡¨å•éªŒè¯
   - åç«¯æ•°æ®éªŒè¯
   - é˜²æ­¢SQLæ³¨å…¥

4. **æ€§èƒ½ä¼˜åŒ–**
   - å›¾ç‰‡å‹ç¼©ä¸Šä¼ 
   - åˆ—è¡¨åˆ†é¡µåŠ è½½
   - åˆç†ä½¿ç”¨ç¼“å­˜

---

## ğŸš€ å¿«é€Ÿå¼€å§‹å¼€å‘

```bash
# 1. å®‰è£…bcrypt (å¦‚æœªå®‰è£…)
cd backend
npm install bcryptjs jsonwebtoken

# 2. åˆ›å»ºç®¡ç†å‘˜è¡¨
node scripts/createAdminTables.js

# 3. åˆ›å»ºadminé¡¹ç›®
cd ..
npm create vite@latest admin -- --template vue
cd admin
npm install
npm install element-plus vue-router pinia axios qrcode file-saver jszip

# 4. å¯åŠ¨å¼€å‘
# ç»ˆç«¯1: åç«¯
cd backend
npm run dev

# ç»ˆç«¯2: å‰ç«¯Cç«¯
cd frontend
npm run dev

# ç»ˆç«¯3: ç®¡ç†åå°
cd admin
npm run dev
```

---

## ğŸ“ éœ€è¦å¸®åŠ©?

å¦‚æœåœ¨å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜,è¯·å‚è€ƒ:
1. ADMIN_PLAN.md - è¯¦ç»†åŠŸèƒ½è§„åˆ’
2. README.md - é¡¹ç›®æ€»è§ˆ
3. backend/routes/ - APIæ¥å£ç¤ºä¾‹
4. frontend/src/ - å‰ç«¯ä»£ç å‚è€ƒ

ç¥å¼€å‘é¡ºåˆ©! ğŸ‰
